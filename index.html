<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Haltestelle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        h1 {
            font-size: 5rem;
        }
        button {
            font-size: 2rem;
            padding: 15px 30px;
            margin-top: 20px;
        }
    </style>
    <script>
        let connectedDevices = 0;

        function updateCount() {
            fetch('/connections')
                .then(response => response.json())
                .then(data => {
                    connectedDevices = data.count;
                    document.getElementById('deviceCount').innerText = connectedDevices;

                    if (connectedDevices > 1) {
                        document.getElementById('connectButton').style.display = 'block';
                    } else {
                        document.getElementById('connectButton').style.display = 'none';
                    }
                });
        }

        function connectBluetooth() {
            navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['generic_access']
            }).then(device => {
                console.log("Connected to Bluetooth:", device.name);
                fetch('/increase', { method: 'POST' });
            }).catch(error => {
                console.error("Bluetooth connection failed:", error);
            });
        }

        setInterval(updateCount, 5000);
    </script>
</head>
<body>
    <h1>Connected: <span id="deviceCount">0</span></h1>
    <button id="connectButton" onclick="connectBluetooth()" style="display:none;">Connect via Bluetooth</button>
</body>
</html>
